# 系统总体架构设计

**文档版本**: v1.1.0
**最后更新**: 2025-09-22
**负责人**: Kelin
**适用阶段**: MVP及向 V2.0 性能优化过渡阶段
**来源依据**: 基于并扩展《[MVP系统设计文档](../MVP系统设计文档.md)》的总体抽象与约束细化

---

## 1 文档职责

本文件定义雷达数据处理系统（MVP → V2.0）的总体架构蓝图，覆盖：
1) 分层与模块边界
2) 数据/控制主通路
3) 并发执行与资源组织模型
4) 关键性能/可靠性/扩展/开发约束
5) 架构演进路径（仅限真实算法集成与性能优化阶段）
6) 决策记录与管控要点

已明确不在本文件范围内的内容：硬件/软件品牌或型号选型、供应链、预算、部署拓扑细节（这些在规划或运维类文档中维护）。

### 1.1 目录

- [系统总体架构设计](#系统总体架构设计)
  - [1 文档职责](#1-文档职责)
    - [1.1 目录](#11-目录)
  - [2 架构概述](#2-架构概述)
    - [2.1 核心设计理念](#21-核心设计理念)
  - [3 系统分层架构](#3-系统分层架构)
    - [3.1 分层职责说明](#31-分层职责说明)
  - [4 核心组件架构](#4-核心组件架构)
    - [4.1 数据流处理管道](#41-数据流处理管道)
      - [4.1.1 关键设计特点](#411-关键设计特点)
    - [4.2 并发执行模型](#42-并发执行模型)
  - [5 架构约束条件](#5-架构约束条件)
  - [架构约束条件](#架构约束条件)
    - [5.1 性能约束](#51-性能约束)
    - [5.2 可靠性约束](#52-可靠性约束)
    - [5.3 扩展性约束](#53-扩展性约束)
    - [5.4 开发约束](#54-开发约束)
  - [6 架构演进路径](#6-架构演进路径)
    - [6.1 MVP阶段目标](#61-mvp阶段目标)
    - [6.2 阶段性演进（聚焦真实算法与性能）](#62-阶段性演进聚焦真实算法与性能)
  - [7 架构决策记录](#7-架构决策记录)
  - [8 实施注意事项](#8-实施注意事项)
  - [9 相关文档](#9-相关文档)
  - [10 变更历史](#10-变更历史)

---

---

## 2 架构概述

基于GPU的相控阵雷达数据处理系统采用**分层模块化架构**，重点验证数据流转和任务调度机制。系统围绕**高性能实时处理**的核心目标，建立了清晰的组件边界和标准化接口。

### 2.1 核心设计理念

- **简化优先**：MVP阶段专注核心数据流验证，避免过度设计
- **模块化分离**：每个模块职责清晰，支持并行开发和独立测试
- **性能导向**：充分利用CPU多核和GPU并行计算能力
- **可扩展性**：为后续算法集成和功能扩展预留架构空间

---

---

## 3 系统分层架构

系统采用四层架构设计，从下到上分别为：基础设施层、核心服务层、业务处理层和用户交互层。

```mermaid
graph TB
    subgraph "用户交互层"
        UI[显控界面模块<br/>数据可视化和用户控制]
    end

    subgraph "业务处理层"
        DR[数据接收模块<br/>UDP数据接收和验证]
        SP[信号处理模块<br/>GPU加速信号处理]
        DP[数据处理模块<br/>CFAR检测和航迹关联]
    end

    subgraph "核心服务层"
        TS[任务调度器<br/>模块生命周期管理]
        TM[线程管理器<br/>线程池和资源调度]
        CM[配置管理器<br/>系统参数管理]
    end

    subgraph "基础设施层"
        LOG[日志服务<br/>结构化日志记录]
        MON[性能监控<br/>实时指标收集]
        QUEUE[数据队列<br/>线程安全通信]
        GPU_MGR[GPU管理器<br/>计算资源分配]
    end

    %% 层间依赖关系
    UI --> DR
    UI --> SP
    UI --> DP

    DR --> TS
    SP --> TS
    DP --> TS

    TS --> LOG
    TM --> MON
    CM --> QUEUE

    %% 数据流向
    DR -.->|原始数据| SP
    SP -.->|处理结果| DP
    DP -.->|最终结果| UI

    classDef presentation fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef business fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef service fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef infrastructure fill:#f8bbd9,stroke:#c2185b,stroke-width:2px

    class UI presentation
    class DR,SP,DP business
    class TS,TM,CM service
    class LOG,MON,QUEUE,GPU_MGR infrastructure
```

### 3.1 分层职责说明

| 层次           | 主要职责                       | 关键组件                           | 设计约束                      |
| -------------- | ------------------------------ | ---------------------------------- | ----------------------------- |
| **用户交互层** | 数据可视化、用户控制、状态展示 | Qt图形界面、图表渲染器             | 响应时间<16ms，界面线程独立   |
| **业务处理层** | 数据接收、信号处理、算法执行   | UDP接收器、GPU计算单元、算法模拟器 | 处理延迟<10ms，支持流水线并行 |
| **核心服务层** | 任务调度、资源管理、配置服务   | 调度器、线程池、配置加载器         | 调度开销<1ms，资源利用率>80%  |
| **基础设施层** | 日志记录、性能监控、通信支持   | 日志系统、监控组件、数据队列       | 异步处理，不阻塞业务流程      |

---

---

## 4 核心组件架构

### 4.1 数据流处理管道

系统的核心是一条高效的数据流处理管道，实现从雷达原始数据到可视化结果的端到端处理：

```mermaid
flowchart LR
    subgraph "数据流处理管道"
        RADAR[雷达阵面] -->|UDP传输| RECEIVER[数据接收器]
        RECEIVER -->|环形缓冲区A| SIGNAL[信号处理器]
        SIGNAL -->|环形缓冲区B| DATA[数据处理器]
        DATA -->|结果队列| DISPLAY[显示控制器]
        DISPLAY -->|可视化| USER[用户界面]
    end

    %% 控制流（虚线）
    USER -.->|控制命令| SCHEDULER[任务调度器]
    SCHEDULER -.->|生命周期管理| RECEIVER
    SCHEDULER -.->|任务分配| SIGNAL
    SCHEDULER -.->|资源调度| DATA

    classDef data fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef control fill:#fff3e0,stroke:#f57c00,stroke-width:2px

    class RADAR,RECEIVER,SIGNAL,DATA,DISPLAY,USER data
    class SCHEDULER control
```

#### 4.1.1 关键设计特点

| 目标         | 机制                              | 说明                           |
| ------------ | --------------------------------- | ------------------------------ |
| 流水线并行   | 多阶段解耦 + 有界环形缓冲         | 保持处理连续性，避免全局锁等待 |
| 背压控制     | 基于队列深度阈值调节上游提取速率  | 防止内存膨胀与 GPU 队列过载    |
| 零拷贝优化   | 预分配对齐内存 + 就地处理策略     | 降低缓存失效与 PCIe 传输开销   |
| 可视化及时性 | 单向结果队列 + UI 异步拉取        | 避免阻塞主处理路径             |
| 监控可观测性 | 指标采集钩子（阶段耗时/队列水位） | 支撑性能调优与异常定位         |

### 4.2 并发执行模型

系统采用多种并发模式的组合，最大化利用硬件资源：

```mermaid
graph TB
    subgraph "并发执行模型"
        subgraph "I/O密集型线程"
            IO_THREAD[数据接收线程<br/>单线程异步I/O]
        end

        subgraph "计算密集型线程池"
            COMPUTE_POOL[信号处理线程池<br/>工作窃取模式]
        end

        subgraph "串行处理线程"
            SERIAL_THREAD[数据处理线程<br/>时序保证]
        end

        subgraph "GPU计算资源"
            GPU_STREAM[GPU计算流<br/>异步并行计算]
        end

        subgraph "用户界面线程"
            UI_THREAD[Qt主线程<br/>事件循环]
        end

        %% 数据流和控制流
        IO_THREAD -->|原始数据| COMPUTE_POOL
        COMPUTE_POOL -->|GPU任务| GPU_STREAM
        GPU_STREAM -->|计算结果| SERIAL_THREAD
        SERIAL_THREAD -->|最终结果| UI_THREAD
    end

    classDef io fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef compute fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef serial fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef gpu fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef ui fill:#f8bbd9,stroke:#c2185b,stroke-width:2px

    class IO_THREAD io
    class COMPUTE_POOL compute
    class SERIAL_THREAD serial
    class GPU_STREAM gpu
    class UI_THREAD ui
```

---

---

## 5 架构约束条件

---

## 架构约束条件

### 5.1 性能约束

- **数据处理延迟**：端到端处理延迟 ≤ 10ms
- **数据吞吐量**：支持 ≥ 1GB/s 的数据处理能力
- **资源利用率**：CPU利用率 ≤ 70%，GPU利用率 ≥ 80%
- **内存使用**：系统内存使用率 ≤ 80%

### 5.2 可靠性约束

- **系统可用性**：≥ 99.9%的运行时间
- **数据完整性**：≥ 99.99%的数据包完整处理
- **错误恢复**：≤ 5分钟的故障恢复时间
- **故障间隔**：≥ 1000小时的平均故障间隔

### 5.3 扩展性约束

- **模块独立性**：模块间通过标准接口通信，支持独立升级
- **算法可替换**：信号处理算法支持插件化替换
- **硬件扩展性**：支持多GPU配置和分布式部署
- **配置驱动**：关键参数通过配置文件控制，支持运行时调整

### 5.4 开发约束

- **代码质量**：单元测试覆盖率 ≥ 90%
- **接口稳定性**：公共接口向后兼容，版本化管理
- **文档同步**：代码变更必须同步更新设计文档
- **评审机制**：关键代码变更必须经过同行评审

---

---

## 6 架构演进路径

### 6.1 MVP阶段目标

- ✅ **核心架构验证**：验证分层架构和模块化设计的可行性
- ✅ **数据流验证**：验证端到端数据流处理的正确性和性能
- ✅ **并发模型验证**：验证多线程调度和GPU计算的协调机制
- ✅ **接口规范建立**：建立标准化的模块间通信协议

### 6.2 阶段性演进（聚焦真实算法与性能）

```mermaid
flowchart LR
    subgraph EVOLUTION[架构演进]
        MVP[MVP阶段\n架构/通路验证] --> V1[V1.0\n集成真实算法]
        V1 --> V2[V2.0\n性能深化优化]
    end

    MVP -.-> VALID[验证输出\b瓶颈列表]
    V1 -.-> PROF[性能画像\n热点分布]
    V2 -.-> STAB[稳定性数据\n长稳运行]

    classDef phase fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef artifact fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    class MVP,V1,V2 phase
    class VALID,PROF,STAB artifact
```

| 阶段 | 目标聚焦                          | 成功判据                             | 关键输出                 | 风险缓解                         |
| ---- | --------------------------------- | ------------------------------------ | ------------------------ | -------------------------------- |
| MVP  | 架构与数据/控制通路正确性         | 端到端延迟≤规划值 + 模块生命周期稳定 | 骨架代码/模块接口清单    | 限制范围，使用模拟器代替复杂算法 |
| V1.0 | 引入真实信号/检测/关联核心算法    | 功能正确 + 正确率指标基线就绪        | 算法适配层、性能基准初稿 | GPU内核审计，建立最小可剖析用例  |
| V2.0 | 性能与稳定性强化（低延迟/高吞吐） | 关键性能≥目标；24h稳定运行           | 优化报告、瓶颈闭环矩阵   | 分阶段压测，指标看板实时预警     |

阶段性优化主线：数据局部复制减少 → GPU/CPU 并行度提升 → 队列水位与调度策略协同 → 热点函数向量化 / CUDA kernel 调整 → 全流程观测指标闭环。

---

---

## 7 架构决策记录

| 决策ID     | 决策内容              | 理由                         | 影响                         | 状态    |
| ---------- | --------------------- | ---------------------------- | ---------------------------- | ------- |
| **AD-001** | 采用分层模块化架构    | 支持并行开发，便于测试和维护 | 增加接口复杂度，提升可维护性 | ✅已确认 |
| **AD-002** | 使用Qt作为GUI框架     | 跨平台支持，图表组件丰富     | 增加包大小，提供完整UI功能   | ✅已确认 |
| **AD-003** | GPU计算采用CUDA       | 生态成熟，性能优秀           | 绑定NVIDIA平台，获得最佳性能 | ✅已确认 |
| **AD-004** | MVP阶段使用算法模拟器 | 降低开发复杂度，专注架构验证 | 不能验证真实算法性能         | ✅已确认 |

---

---

## 8 实施注意事项

> ⚠️ **架构实施要点**：
> - 严格遵循分层原则，避免跨层直接调用
> - 接口设计必须考虑向后兼容性
> - 性能关键路径需要特别关注线程安全和内存管理
> - 模块间通信必须通过标准化接口，避免紧耦合

---

---

## 9 相关文档

- [需求分析与MVP目标](01_需求分析与目标.md)
- [技术选型与硬件平台](02_技术选型与平台.md)
- [系统架构总览](03_系统架构总览.md)
- [核心设计原则](04_核心设计原则.md)

---

---

## 10 变更历史

| 版本   | 日期       | 作者    | 变更描述                                                                                              |
| ------ | ---------- | ------- | ----------------------------------------------------------------------------------------------------- |
| v1.0.0 | 2025-09-22 | Kelin   | 基于MVP设计文档创建总体架构设计                                                                       |
| v1.1.0 | 2025-09-22 | Copilot | 标题编号化；移除技术选型内容；重构演进路径（至V2.0）；补充数据流/并发细化；增强约束表达；更新范围声明 |

---

*本架构设计为雷达数据处理系统MVP的技术实施提供顶层指导，确保系统设计的一致性和可扩展性。*
